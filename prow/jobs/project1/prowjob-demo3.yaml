branch_spec: &branch_spec
  - ^master$
presubmits:
  awsgcr/aws-infra:
    - name: presubmit-aws-permission-verify
      run_if_changed: '^app/gitops-prow-demo/main.go$'
      agent: kubernetes
      always_run: false
      spec:
        containers:
        - image: public.ecr.aws/aws-cli/aws-cli
          imagePullPolicy: Always
          command:
          - /bin/bash
          args:
            - -c
            - |
              source $(which error-trap)           
              rm -rf .git
              echo "✅ Verified AWS permission!" >> .content
              echo "✅ You can deploy these changes!" >> .content
              set +x
              pr-comment --repo_owner ${REPO_OWNER} --repo_name ${REPO_NAME} --pull_base_sha ${PULL_BASE_SHA} -f .content
